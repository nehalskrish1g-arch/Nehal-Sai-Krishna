<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knapsack Algorithm Visualizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap');

        * {
            font-family: 'Inter', sans-serif;
        }

        code,
        pre {
            font-family: 'Fira Code', monospace;
        }

        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%);
        }

        .glass-panel {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(148, 163, 184, 0.1);
        }

        .code-line {
            transition: all 0.3s ease;
            padding: 2px 4px;
            border-radius: 2px;
            font-size: 10px;
        }

        .code-line.active {
            background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
            font-weight: 500;
        }

        .code-line.completed {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .item-card {
            transition: all 0.3s ease;
        }

        .item-card.selected {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
            border-color: #3b82f6 !important;
        }

        .dp-cell {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 28px;
            height: 24px;
            font-size: 10px;
        }

        .dp-cell.active {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%) !important;
            color: white;
            transform: scale(1.15);
            z-index: 10;
        }

        .dp-cell.updated {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
            color: white;
        }

        .dp-cell.comparing {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%) !important;
            color: white;
        }

        .control-btn {
            transition: all 0.2s ease;
        }

        .control-btn:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .control-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        ::-webkit-scrollbar {
            width: 4px;
            height: 4px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.3);
            border-radius: 2px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(148, 163, 184, 0.3);
            border-radius: 2px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(148, 163, 184, 0.5);
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>

<body class="h-screen overflow-hidden text-slate-200">
    <div class="h-full flex flex-col p-3 gap-3">
        <!-- Header -->
        <header class="glass-panel rounded-lg px-4 py-2 flex items-center justify-between flex-shrink-0">
            <div class="flex items-center gap-4">
                <a href="index.html" class="text-slate-400 hover:text-white transition flex items-center gap-1 text-xs">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                    </svg>
                    Back
                </a>
                <div class="h-4 w-px bg-slate-600"></div>
                <h1
                    class="text-base font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">
                    0/1 Knapsack Algorithm</h1>
            </div>
            <div class="flex items-center gap-4 text-xs">
                <span class="text-slate-400">Dynamic Programming</span>
                <div class="flex items-center gap-2">
                    <span class="text-slate-500">Time: O(n√óW)</span>
                    <span class="text-slate-500">Space: O(n√óW)</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="flex-1 min-h-0 grid grid-cols-12 gap-3">
            <!-- Visualization Panel (Left - 8 cols) -->
            <div class="col-span-8 glass-panel rounded-lg p-3 flex flex-col min-h-0">
                <div class="flex items-center justify-between mb-2 flex-shrink-0">
                    <h2 class="text-sm font-semibold text-slate-300">Visualization</h2>
                    <div class="flex items-center gap-2">
                        <span class="text-[10px] text-slate-500">Step:</span>
                        <span id="stepCounter"
                            class="px-2 py-0.5 bg-blue-500/20 text-blue-400 rounded text-[10px] font-bold">0</span>
                    </div>
                </div>

                <!-- Step Explanation -->
                <div class="mb-2 p-2 bg-slate-800/50 rounded border border-slate-700/50 flex-shrink-0">
                    <p id="stepExplanation" class="text-[10px] text-slate-300" aria-live="polite">Initialize the
                        visualization to begin</p>
                </div>

                <!-- Items Display -->
                <div class="mb-2 flex-shrink-0">
                    <h3 class="text-[10px] font-semibold text-slate-400 mb-1">Items:</h3>
                    <div id="itemsDisplay" class="flex flex-wrap gap-1">
                        <!-- Items will be displayed here -->
                    </div>
                </div>

                <!-- DP Table -->
                <div class="flex-1 min-h-0 overflow-auto">
                    <h3 class="text-[10px] font-semibold text-slate-400 mb-1">DP Table:</h3>
                    <div id="dpTable" class="inline-block">
                        <!-- DP table will be generated here -->
                    </div>
                </div>

                <!-- Result Display -->
                <div id="resultDisplay"
                    class="mt-2 p-2 bg-emerald-500/10 rounded border border-emerald-500/30 hidden flex-shrink-0">
                    <div class="flex items-center justify-between">
                        <div>
                            <span class="text-[10px] text-emerald-400">Maximum Value:</span>
                            <span id="maxValue" class="text-sm font-bold text-emerald-400 ml-1">0</span>
                        </div>
                        <div class="text-[10px] text-slate-400">
                            Selected: <span id="selectedItems" class="text-emerald-400"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar (Right - 4 cols) -->
            <div class="col-span-4 flex flex-col gap-3 min-h-0">
                <!-- Controls Panel -->
                <div class="glass-panel rounded-lg p-3 flex-shrink-0">
                    <h2 class="text-xs font-semibold text-slate-300 mb-2">Problem Setup</h2>

                    <div class="grid grid-cols-2 gap-2 mb-2">
                        <div>
                            <label for="capacity" class="block text-[10px] text-slate-400 mb-1">Capacity</label>
                            <input type="number" id="capacity" value="10" min="1" max="15"
                                class="w-full px-2 py-1 bg-slate-800/50 border border-slate-600/50 rounded text-xs text-slate-200 focus:border-blue-500 focus:outline-none">
                        </div>
                        <div>
                            <label for="speed" class="block text-[10px] text-slate-400 mb-1">Speed: <span
                                    id="speedDisplay">800</span>ms</label>
                            <input type="range" id="speed" min="100" max="2000" value="800" step="100"
                                class="w-full h-1">
                        </div>
                    </div>

                    <div class="mb-2">
                        <label class="block text-[10px] text-slate-400 mb-1">Items (W, V)</label>
                        <div class="grid grid-cols-2 gap-1 max-h-20 overflow-y-auto" id="itemsInput">
                            <!-- Items will be generated here -->
                        </div>
                        <div class="mt-1 flex gap-1">
                            <button onclick="addItem()"
                                class="flex-1 px-2 py-1 bg-emerald-500/20 text-emerald-400 rounded text-[10px] hover:bg-emerald-500/30 transition">+
                                Add</button>
                            <button onclick="generateRandomItems()"
                                class="flex-1 px-2 py-1 bg-purple-500/20 text-purple-400 rounded text-[10px] hover:bg-purple-500/30 transition">üé≤
                                Random</button>
                        </div>
                    </div>

                    <button onclick="startVisualization()" id="startBtn"
                        class="w-full control-btn px-3 py-1.5 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded text-xs font-semibold hover:from-blue-600 hover:to-purple-600">
                        Start Visualization
                    </button>
                </div>

                <!-- Playback Controls -->
                <div class="glass-panel rounded-lg p-3 flex-shrink-0">
                    <h2 class="text-xs font-semibold text-slate-300 mb-2">Playback</h2>
                    <div class="grid grid-cols-4 gap-1">
                        <button onclick="play()" id="playBtn" disabled
                            class="control-btn px-2 py-1.5 bg-emerald-500/20 text-emerald-400 rounded text-[10px] font-medium disabled:opacity-40">‚ñ∂
                            Play</button>
                        <button onclick="pause()" id="pauseBtn" disabled
                            class="control-btn px-2 py-1.5 bg-amber-500/20 text-amber-400 rounded text-[10px] font-medium disabled:opacity-40">‚è∏
                            Pause</button>
                        <button onclick="stepForward()" id="stepBtn" disabled
                            class="control-btn px-2 py-1.5 bg-blue-500/20 text-blue-400 rounded text-[10px] font-medium disabled:opacity-40">‚è≠
                            Step</button>
                        <button onclick="reset()" id="resetBtn" disabled
                            class="control-btn px-2 py-1.5 bg-red-500/20 text-red-400 rounded text-[10px] font-medium disabled:opacity-40">‚Ü∫
                            Reset</button>
                    </div>
                </div>

                <!-- Pseudocode Panel -->
                <div class="glass-panel rounded-lg p-3 flex-1 min-h-0 flex flex-col">
                    <h2 class="text-xs font-semibold text-slate-300 mb-2 flex-shrink-0">Pseudocode</h2>
                    <div class="bg-slate-900/50 rounded p-2 overflow-auto flex-1 min-h-0" id="codePanel">
                        <pre class="text-[10px] leading-relaxed"><code id="pseudocode"></code></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State management
        let state = {
            items: [{ weight: 2, value: 3 }, { weight: 3, value: 4 }, { weight: 4, value: 5 }, { weight: 5, value: 6 }],
            capacity: 10,
            dp: [],
            currentStep: 0,
            steps: [],
            isPlaying: false,
            isPaused: false,
            speed: 800,
            animationTimeout: null
        };

        // Pseudocode lines
        const pseudocode = [
            'function knapsack(items, capacity):',
            '    n = length(items)',
            '    dp[0...n][0...capacity] = 0',
            '    ',
            '    for i from 1 to n:',
            '        for w from 0 to capacity:',
            '            if items[i-1].weight > w:',
            '                dp[i][w] = dp[i-1][w]',
            '            else:',
            '                include = dp[i-1][w-weight] + value',
            '                exclude = dp[i-1][w]',
            '                dp[i][w] = max(include, exclude)',
            '    ',
            '    return dp[n][capacity]'
        ];

        // Initialize
        function init() {
            renderPseudocode();
            renderItemsInput();
            updateSpeedDisplay();

            document.getElementById('speed').addEventListener('input', (e) => {
                state.speed = parseInt(e.target.value);
                updateSpeedDisplay();
            });
        }

        function renderPseudocode() {
            const codeElement = document.getElementById('pseudocode');
            codeElement.innerHTML = pseudocode.map((line, i) =>
                `<div class="code-line" id="code-line-${i}">${line}</div>`
            ).join('');
        }

        function updateSpeedDisplay() {
            document.getElementById('speedDisplay').textContent = state.speed;
        }

        function renderItemsInput() {
            const container = document.getElementById('itemsInput');
            container.innerHTML = state.items.map((item, i) => `
                <div class="flex items-center gap-1 bg-slate-800/50 p-1 rounded border border-slate-700/50">
                    <input type="number" value="${item.weight}" min="1" max="15"
                           onchange="updateItem(${i}, 'weight', this.value)"
                           class="w-8 px-1 py-0.5 bg-slate-900/50 border border-slate-600/50 rounded text-[10px] text-slate-200" placeholder="W">
                    <input type="number" value="${item.value}" min="1" max="50"
                           onchange="updateItem(${i}, 'value', this.value)"
                           class="w-8 px-1 py-0.5 bg-slate-900/50 border border-slate-600/50 rounded text-[10px] text-slate-200" placeholder="V">
                    <button onclick="removeItem(${i})" class="text-red-400 hover:text-red-300 text-xs px-1">√ó</button>
                </div>
            `).join('');
        }

        function updateItem(index, field, value) {
            state.items[index][field] = parseInt(value);
        }

        function addItem() {
            if (state.items.length < 8) {
                state.items.push({ weight: 1, value: 1 });
                renderItemsInput();
            }
        }

        function removeItem(index) {
            if (state.items.length > 1) {
                state.items.splice(index, 1);
                renderItemsInput();
            }
        }

        function generateRandomItems() {
            const count = Math.floor(Math.random() * 4) + 3; // 3-6 items
            state.items = [];
            for (let i = 0; i < count; i++) {
                state.items.push({
                    weight: Math.floor(Math.random() * 6) + 1,
                    value: Math.floor(Math.random() * 12) + 3
                });
            }
            renderItemsInput();
        }

        function startVisualization() {
            state.capacity = parseInt(document.getElementById('capacity').value);
            state.currentStep = 0;
            state.isPlaying = false;
            state.isPaused = false;

            // Generate steps
            generateSteps();

            // Initialize DP table
            initializeDPTable();

            // Display items
            displayItems();

            // Enable controls
            document.getElementById('startBtn').disabled = true;
            document.getElementById('playBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = false;
            document.getElementById('stepBtn').disabled = false;
            document.getElementById('resetBtn').disabled = false;

            // Show first step
            visualizeStep(0);
        }

        function generateSteps() {
            state.steps = [];
            const n = state.items.length;
            const W = state.capacity;

            // Initialize DP array
            const dp = Array(n + 1).fill(0).map(() => Array(W + 1).fill(0));

            // Step: Initialization
            state.steps.push({
                line: 2,
                explanation: `Initializing DP table with dimensions [${n + 1}][${W + 1}]. All cells start at 0.`,
                i: -1,
                w: -1,
                action: 'init'
            });

            // Main algorithm
            for (let i = 1; i <= n; i++) {
                for (let w = 0; w <= W; w++) {
                    const item = state.items[i - 1];

                    state.steps.push({
                        line: 6,
                        explanation: `Checking item ${i} (weight=${item.weight}, value=${item.value}) for capacity ${w}`,
                        i: i,
                        w: w,
                        action: 'check',
                        itemIndex: i - 1
                    });

                    if (item.weight > w) {
                        dp[i][w] = dp[i - 1][w];
                        state.steps.push({
                            line: 7,
                            explanation: `Item ${i} is too heavy (${item.weight} > ${w}). Exclude it: dp[${i}][${w}] = ${dp[i][w]}`,
                            i: i,
                            w: w,
                            action: 'exclude',
                            value: dp[i][w],
                            itemIndex: i - 1
                        });
                    } else {
                        const include = dp[i - 1][w - item.weight] + item.value;
                        const exclude = dp[i - 1][w];

                        state.steps.push({
                            line: 10,
                            explanation: `Item ${i} fits! Include: ${include} (from dp[${i - 1}][${w - item.weight}] + ${item.value}), Exclude: ${exclude}`,
                            i: i,
                            w: w,
                            action: 'compare',
                            include: include,
                            exclude: exclude,
                            itemIndex: i - 1
                        });

                        dp[i][w] = Math.max(include, exclude);

                        state.steps.push({
                            line: 11,
                            explanation: `Choose maximum: dp[${i}][${w}] = ${dp[i][w]}`,
                            i: i,
                            w: w,
                            action: 'update',
                            value: dp[i][w],
                            itemIndex: i - 1
                        });
                    }
                }
            }

            // Final step
            state.steps.push({
                line: 13,
                explanation: `Algorithm complete! Maximum value: ${dp[n][W]}`,
                i: n,
                w: W,
                action: 'complete',
                maxValue: dp[n][W]
            });

            state.dp = dp;
        }

        function initializeDPTable() {
            const n = state.items.length;
            const W = state.capacity;
            const tableContainer = document.getElementById('dpTable');

            let html = '<table class="border-collapse">';

            // Header row
            html += '<tr><th class="dp-cell border border-slate-600/50 bg-slate-700/50 text-[10px] font-bold text-slate-400">i/w</th>';
            for (let w = 0; w <= W; w++) {
                html += `<th class="dp-cell border border-slate-600/50 bg-slate-700/50 text-[10px] font-bold text-slate-400">${w}</th>`;
            }
            html += '</tr>';

            // Data rows
            for (let i = 0; i <= n; i++) {
                html += '<tr>';
                html += `<th class="dp-cell border border-slate-600/50 bg-slate-700/50 text-[10px] font-bold text-slate-400">${i}</th>`;
                for (let w = 0; w <= W; w++) {
                    html += `<td class="dp-cell border border-slate-600/50 text-center font-semibold bg-slate-800/50 text-slate-300" id="cell-${i}-${w}">0</td>`;
                }
                html += '</tr>';
            }

            html += '</table>';
            tableContainer.innerHTML = html;
        }

        function displayItems() {
            const container = document.getElementById('itemsDisplay');
            container.innerHTML = state.items.map((item, i) => `
                <div class="item-card bg-slate-800/50 px-2 py-1 rounded border border-slate-600/50" id="item-${i}">
                    <span class="text-[10px] text-slate-400">Item ${i + 1}:</span>
                    <span class="text-[10px] text-blue-400 ml-1">W=${item.weight}</span>
                    <span class="text-[10px] text-emerald-400 ml-1">V=${item.value}</span>
                </div>
            `).join('');
        }

        function visualizeStep(stepIndex) {
            if (stepIndex >= state.steps.length) {
                complete();
                return;
            }

            const step = state.steps[stepIndex];
            state.currentStep = stepIndex;

            // Update step counter
            document.getElementById('stepCounter').textContent = stepIndex + 1;

            // Update code highlighting
            document.querySelectorAll('.code-line').forEach(line => {
                line.classList.remove('active', 'completed');
            });

            const codeLine = document.getElementById(`code-line-${step.line}`);
            if (codeLine) {
                codeLine.classList.add('active');
                gsap.fromTo(codeLine,
                    { x: -5, opacity: 0.5 },
                    { x: 0, opacity: 1, duration: 0.3 }
                );
            }

            // Update explanation
            document.getElementById('stepExplanation').textContent = step.explanation;
            gsap.fromTo('#stepExplanation',
                { opacity: 0, y: -5 },
                { opacity: 1, y: 0, duration: 0.3 }
            );

            // Update items display
            document.querySelectorAll('.item-card').forEach(card => {
                card.classList.remove('selected');
            });

            if (step.itemIndex !== undefined) {
                const itemCard = document.getElementById(`item-${step.itemIndex}`);
                if (itemCard) {
                    itemCard.classList.add('selected');
                    gsap.fromTo(itemCard,
                        { scale: 1 },
                        { scale: 1.05, duration: 0.3 }
                    );
                }
            }

            // Update DP table
            if (step.i >= 0 && step.w >= 0) {
                // Clear previous highlights
                document.querySelectorAll('.dp-cell').forEach(cell => {
                    cell.classList.remove('active', 'updated', 'comparing');
                });

                const cell = document.getElementById(`cell-${step.i}-${step.w}`);

                if (step.action === 'check') {
                    cell.classList.add('active');
                    gsap.fromTo(cell,
                        { scale: 1 },
                        { scale: 1.15, duration: 0.3, yoyo: true, repeat: 1 }
                    );
                } else if (step.action === 'compare') {
                    cell.classList.add('comparing');
                } else if (step.action === 'update' || step.action === 'exclude') {
                    cell.textContent = step.value;
                    cell.classList.add('updated');
                    gsap.fromTo(cell,
                        { scale: 1.2 },
                        { scale: 1, duration: 0.4 }
                    );
                }
            }
        }

        function play() {
            if (state.currentStep >= state.steps.length - 1) {
                reset();
                return;
            }

            state.isPlaying = true;
            state.isPaused = false;
            document.getElementById('playBtn').disabled = true;
            document.getElementById('pauseBtn').disabled = false;

            playNext();
        }

        function playNext() {
            if (!state.isPlaying || state.currentStep >= state.steps.length - 1) {
                state.isPlaying = false;
                document.getElementById('playBtn').disabled = false;
                document.getElementById('pauseBtn').disabled = true;
                return;
            }

            state.currentStep++;
            visualizeStep(state.currentStep);

            state.animationTimeout = setTimeout(playNext, state.speed);
        }

        function pause() {
            state.isPlaying = false;
            state.isPaused = true;
            clearTimeout(state.animationTimeout);
            document.getElementById('playBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
        }

        function stepForward() {
            if (state.currentStep < state.steps.length - 1) {
                state.currentStep++;
                visualizeStep(state.currentStep);
            }
        }

        function reset() {
            state.isPlaying = false;
            state.isPaused = false;
            state.currentStep = 0;
            clearTimeout(state.animationTimeout);

            document.getElementById('startBtn').disabled = false;
            document.getElementById('playBtn').disabled = true;
            document.getElementById('pauseBtn').disabled = true;
            document.getElementById('stepBtn').disabled = true;
            document.getElementById('resetBtn').disabled = true;

            document.getElementById('resultDisplay').classList.add('hidden');
            document.getElementById('stepCounter').textContent = '0';
            document.getElementById('stepExplanation').textContent = 'Initialize the visualization to begin';

            document.querySelectorAll('.code-line').forEach(line => {
                line.classList.remove('active', 'completed');
            });

            document.querySelectorAll('.dp-cell').forEach(cell => {
                cell.classList.remove('active', 'updated', 'comparing');
            });

            document.querySelectorAll('.item-card').forEach(card => {
                card.classList.remove('selected');
            });
        }

        function complete() {
            state.isPlaying = false;
            const maxValue = state.dp[state.items.length][state.capacity];

            // Find selected items
            const selectedItems = [];
            let i = state.items.length;
            let w = state.capacity;

            while (i > 0 && w > 0) {
                if (state.dp[i][w] !== state.dp[i - 1][w]) {
                    selectedItems.unshift(i);
                    w -= state.items[i - 1].weight;
                }
                i--;
            }

            document.getElementById('maxValue').textContent = maxValue;
            document.getElementById('selectedItems').textContent = selectedItems.join(', ');
            document.getElementById('resultDisplay').classList.remove('hidden');

            gsap.fromTo('#resultDisplay',
                { scale: 0.9, opacity: 0 },
                { scale: 1, opacity: 1, duration: 0.4, ease: 'back.out(1.7)' }
            );

            document.getElementById('playBtn').disabled = true;
            document.getElementById('pauseBtn').disabled = true;
            document.getElementById('stepBtn').disabled = true;
        }

        // Initialize on load
        init();
    </script>
</body>

</html>